{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"Resolution du .bash_aliases","text":""},{"location":"#comment-le-trouver","title":"Comment le trouver","text":"<pre><code>type chmod\n</code></pre>"},{"location":"#homeuserbash_aliases","title":"/home/user/.bash_aliases","text":"<pre><code>- alias chmod=/pwet/chmod1.sh\n</code></pre>"},{"location":"#pwetchmod1sh","title":"/pwet/chmod1.sh","text":"<pre><code>#!/usr/bin/env bash\n\necho -e \"\\nCoucou !\\n\"\n/usr/bin/chmod \"$@\"\necho -e \"Au revoir !\\n\"\n</code></pre>"},{"location":"#explication","title":"Explication","text":"<pre><code>- Fais bien le chmod mais a integre des commandes supplementaires\n</code></pre>"},{"location":"#resolution-du-etcpasswd","title":"Resolution du /etc/passwd","text":"<pre><code>root:x:0:0:root:/root:/bin/bash\ndaemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin\nbin:x:2:2:bin:/bin:/usr/sbin/nologin\nsys:x:3:3:sys:/dev:/usr/sbin/nologin\nsync:x:4:65534:sync:/bin:/bin/sync\ngames:x:5:60:games:/usr/games:/usr/sbin/nologin\nman:x:6:12:man:/var/cache/man:/usr/sbin/nologin\nlp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin\nmail:x:8:8:mail:/var/mail:/usr/sbin/nologin\nnews:x:9:9:news:/var/spool/news:/usr/sbin/nologin\nuucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin\nproxy:x:13:13:proxy:/bin:/usr/sbin/nologin\nwww-data:x:33:33:www-data:/var/www:/usr/sbin/nologin\nbackup:x:34:34:backup:/var/backups:/usr/sbin/nologin\nlist:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin\nirc:x:39:39:ircd:/run/ircd:/usr/sbin/nologin\n_apt:x:42:65534::/nonexistent:/usr/sbin/nologin\nnobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin\nsystemd-network:x:998:998:systemd Network Management:/:/usr/sbin/nologin\ndhcpcd:x:100:65534:DHCP Client Daemon:/usr/lib/dhcpcd:/bin/false\nsystemd-timesync:x:991:991:systemd Time Synchronization:/:/usr/sbin/nologin\nmessagebus:x:990:990:System Message Bus:/nonexistent:/usr/sbin/nologin\nsshd:x:989:65534:sshd user:/run/sshd:/usr/sbin/nologin\nuser:x:1000:1000:user,,,:/home/user:/bin/bash\nmy-app:x:1001:1001::/home/my-app:/bin/bash\nmysql:x:101:103:MariaDB Server:/nonexistent:/bin/false\n</code></pre>"},{"location":"#explication_1","title":"Explication","text":"<pre><code>le compte applicatif poss\u00e8de un compte utilisateur et poss\u00e8de un shell\n    shell =&gt; vu avec /bin/bash\n\nPourquoi c\u2019est un probl\u00e8me en environnement ma\u00eetrise ?\nCas normal d\u2019un compte applicatif\n\nUn compte applicatif devrait :\n\n- executer un service\n  - ne jamais se connecter en interactif\n  - ne jamais ouvrir de session SSH\n  - avoir un shell bloque (nologin / false)\n\nOr ici :\n- login possible\n  - shell complet\n  - execution de commandes arbitraires\n</code></pre>"},{"location":"#ss","title":"ss","text":"<pre><code>ss -lu\nState      Recv-Q     Send-Q                             Local Address:Port                    Peer Address:Port\nUNCONN     0          0                                  10.171.200.43:bootpc                       0.0.0.0:*\nUNCONN     0          0              [fe80::d89b:da02:f1fc:4c54]%ens33:dhcpv6-client                   [::]:*\n</code></pre>"},{"location":"#erreur","title":"Erreur","text":"<p>0.0.0.0 =&gt; Autorise l'acc\u00e8s depuis tous les ports</p>"},{"location":"#correctif","title":"Correctif","text":"<pre><code>nano /etc/mysql/mariadb.conf.d/50-server.cnf\n    #bind-address            = 127.0.0.1\n    bind-address            = 0.0.0.0\n    # Inverser puis systemctl\n</code></pre>"},{"location":"#explication_2","title":"Explication","text":"<pre><code>Un port UDP ouvert pour tout le monde peut \u00eatre un vecteur d\u2019attaque, m\u00eame si le service est legitime.\nLa bonne pratique : limiter l\u2019exposition reseau, filtrer par firewall et surveiller le trafic.\n</code></pre>"},{"location":"#etcprofile","title":"/etc/profile","text":""},{"location":"#comment-le-trouver_1","title":"comment le trouver","text":"<pre><code>ls\necho $PATH\n&gt; /pwet:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games\ntype ls\n</code></pre>"},{"location":"#probleme","title":"probl\u00e8me","text":"<pre><code>if [ \"$(id -u)\" -eq 0 ]; then\n  PATH=\"/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\"\nelse\n  PATH=\"/pwet:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games\"\nfi\n</code></pre>"},{"location":"#solution","title":"Solution","text":"<pre><code>PATH securise pour root,\nmais un PATH volontairement detourne pour les utilisateurs,\nafin de faire passer des wrappers avant les commandes syst\u00e8me.\n</code></pre>"},{"location":"#acces-aux-mdp-etcshadow","title":"Acc\u00e8s aux mdp etc/shadow","text":""},{"location":"#probleme_1","title":"Probl\u00e8me","text":"<pre><code>ls -l /etc/shadow\n-rw-r--r-- 1 root shadow 896 Jan  8 15:21 /etc/shadow\n</code></pre>"},{"location":"#solution_1","title":"Solution","text":"<pre><code>chmod 640 /etc/shadow\nroot@debian-secu:~# ls -l /etc/shadow\n-rw--w---- 1 root shadow 896 Jan  8 15:21 /etc/shadow\n</code></pre>"},{"location":"#droits-dacces-git-clone-pour-deploiement","title":"Droits d'acc\u00e8s + git clone pour deploiement","text":""},{"location":"#cat-etcnginx","title":"cat /etc/nginx/","text":""},{"location":"#dans-le-varwwwhtml","title":"dans le /var/www/html","text":"<pre><code>ls -la /var/www/html/\ntotal 16\ndrwxr-xr-x 3 root root 4096 Jan  8 15:43 .\ndrwxr-xr-x 3 root root 4096 Jan  8 15:30 ..\ndrwxrwxr-x 7 root root 4096 Jan  8 15:43 .git\n-rw-r--r-- 1 root root  615 Jan  8 15:30 index.nginx-debian.html\n</code></pre>"},{"location":"#correctif_1","title":"Correctif","text":"<pre><code>Retirer le .git qui se retrouve accessible en curl\n</code></pre>"},{"location":"#etcsshsshd_config","title":"/etc/ssh/sshd_config","text":""},{"location":"#probleme-acces-ssh","title":"probl\u00e8me Acc\u00e8s ssh","text":""},{"location":"#correctif_2","title":"Correctif","text":"<p>Permit root login -&gt; no Autoriser des groupes \u00e0 se connecter en ssh Password_authentication -&gt; no</p>"},{"location":"#acces-mysql-sans-mot-de-passe","title":"Acc\u00e8s mysql sans mot de passe","text":""},{"location":"#probleme_2","title":"probl\u00e8me","text":"<pre><code>mysql\nAcc\u00e8s autorise sans mdp.\n</code></pre>"},{"location":"#risque","title":"Risque","text":"<pre><code>=&gt; select * from mysql.user \\G;\n    Host: localhost\n    User: root\n    Password: invalid\n</code></pre> <pre><code>    Host: localhost\n    User: mysql\n    Password: invalid\n</code></pre> <pre><code>    Host: %\n    User: app\n    Password: *5BCB3E6AC345B435C7C2E6B7949A04CE6F6563D3\n</code></pre> <pre><code>MariaDB [(none)]&gt;  show grants for 'app'@'%';\n+-------------------------------------------------------------------------------------------------------------+\n| Grants for app@%                                                                                            |\n+-------------------------------------------------------------------------------------------------------------+\n| GRANT ALL PRIVILEGES ON *.* TO `app`@`%` IDENTIFIED BY PASSWORD '*5BCB3E6AC345B435C7C2E6B7949A04CE6F6563D3' |\n+-------------------------------------------------------------------------------------------------------------+\n</code></pre>"},{"location":"#explication_3","title":"Explication","text":"<pre><code>- le user app peut se connecter depuis partout\n- root et mysql pas de MDP\n- le user a acc\u00e8s \u00e0 toutes les bases\n</code></pre>"}]}